<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel de Administra√ß√£o</title>

  <!-- Tailwind e √çcones -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

  <!-- ‚úÖ IMPORTANTE: Carrega Firebase e Auth -->
  <script type="module" src="./firebaseconfig.js"></script>
  <script type="module" src="./auth.js"></script>

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: '#F97316',
            "background-light": '#FFFFFF',
            "background-dark": '#1A1A1A',
            'card-light': '#F3F4F6',
            'card-dark': '#2D2D2D',
            'text-light': '#1F2937',
            'text-dark': '#E5E7EB',
            'subtext-light': '#6B7280',
            'subtext-dark': '#9CA3AF',
          },
          fontFamily: { display: ['Inter', 'sans-serif'] },
        },
      },
    };
  </script>

  <style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
    body { min-height: max(884px, 100dvh); }
    
    /* ‚úÖ NOVO: Anima√ß√£o para mostrar campo de pre√ßo */
    .preco-input-container {
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    .variacao-checkbox:checked ~ .preco-input-container {
      max-height: 100px;
      opacity: 1;
      margin-top: 0.5rem;
    }
  </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">
  <div class="container mx-auto p-4 max-w-md">
    
    <!-- Header -->
    <header class="flex items-center justify-between py-4">
      <div>
        <h1 class="text-2xl font-bold">Painel de Admin</h1>
        <p id="admin-info" class="text-sm text-subtext-light dark:text-subtext-dark mt-1">Carregando...</p>
      </div>
      <button id="logoutBtn" class="text-primary hover:text-orange-600 transition-colors">
        <span class="material-symbols-outlined text-3xl">logout</span>
      </button>
    </header>

    <!-- Formul√°rio de Adicionar/Editar -->
    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-4">Adicionar Novo Item</h2>
      <div class="bg-card-light dark:bg-card-dark p-4 rounded-lg">
        <form id="form-prato" class="space-y-4">
          
          <!-- Tipo de Item -->
          <div>
            <label class="block text-sm font-medium mb-2" for="item-tipo">Tipo de Item</label>
            <select id="item-tipo" class="mt-1 block w-full border rounded-md py-2 px-3 dark:bg-gray-700 dark:border-gray-600" required>
              <option value="prato">Prato</option>
              <option value="bebida">Bebida</option>
            </select>
          </div>

          <!-- Nome -->
          <div>
            <label class="block text-sm font-medium" for="dish-name">Nome</label>
            <input 
              id="dish-name" 
              type="text" 
              required
              placeholder="Ex: Pizza Margherita, Coca-Cola..."
              class="mt-1 block w-full border rounded-md py-2 px-3 dark:bg-gray-700 dark:border-gray-600 focus:ring-2 focus:ring-primary focus:border-transparent"
            />
          </div>
          
          <!-- Descri√ß√£o -->
          <div>
            <label class="block text-sm font-medium" for="dish-description">Descri√ß√£o</label>
            <textarea 
              id="dish-description" 
              rows="3" 
              required
              placeholder="Descreva o item..."
              class="mt-1 block w-full border rounded-md py-2 px-3 dark:bg-gray-700 dark:border-gray-600 focus:ring-2 focus:ring-primary focus:border-transparent"
            ></textarea>
          </div>
          
          <!-- ‚úÖ NOVO: Varia√ß√µes COM PRE√áOS (apenas para pratos) -->
          <div id="variacoes-container" class="space-y-3">
            <label class="block text-sm font-medium">Varia√ß√µes e Pre√ßos</label>
            <p class="text-xs text-subtext-light dark:text-subtext-dark mb-2">
              Marque as varia√ß√µes e defina o pre√ßo de cada uma
            </p>
            
            <!-- Frango -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-3">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="variacao" value="frango" class="variacao-checkbox w-4 h-4 text-primary rounded focus:ring-primary">
                <span class="text-sm font-medium flex-grow">üêî Frango</span>
              </label>
              <div class="preco-input-container">
                <input 
                  type="number" 
                  data-preco-variacao="frango"
                  step="0.01" 
                  min="0"
                  placeholder="Pre√ßo (R$)"
                  class="w-full border rounded-md py-2 px-3 text-sm dark:bg-gray-700 dark:border-gray-600"
                />
              </div>
            </div>

            <!-- Gado -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-3">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="variacao" value="gado" class="variacao-checkbox w-4 h-4 text-primary rounded focus:ring-primary">
                <span class="text-sm font-medium flex-grow">ü•© Gado (Carne Bovina)</span>
              </label>
              <div class="preco-input-container">
                <input 
                  type="number" 
                  data-preco-variacao="gado"
                  step="0.01" 
                  min="0"
                  placeholder="Pre√ßo (R$)"
                  class="w-full border rounded-md py-2 px-3 text-sm dark:bg-gray-700 dark:border-gray-600"
                />
              </div>
            </div>

            <!-- Porco -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-3">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="variacao" value="porco" class="variacao-checkbox w-4 h-4 text-primary rounded focus:ring-primary">
                <span class="text-sm font-medium flex-grow">üê∑ Porco</span>
              </label>
              <div class="preco-input-container">
                <input 
                  type="number" 
                  data-preco-variacao="porco"
                  step="0.01" 
                  min="0"
                  placeholder="Pre√ßo (R$)"
                  class="w-full border rounded-md py-2 px-3 text-sm dark:bg-gray-700 dark:border-gray-600"
                />
              </div>
            </div>

            <!-- Peixe -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-3">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="variacao" value="peixe" class="variacao-checkbox w-4 h-4 text-primary rounded focus:ring-primary">
                <span class="text-sm font-medium flex-grow">üêü Peixe</span>
              </label>
              <div class="preco-input-container">
                <input 
                  type="number" 
                  data-preco-variacao="peixe"
                  step="0.01" 
                  min="0"
                  placeholder="Pre√ßo (R$)"
                  class="w-full border rounded-md py-2 px-3 text-sm dark:bg-gray-700 dark:border-gray-600"
                />
              </div>
            </div>

            <!-- Vegano -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-3">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="variacao" value="vegano" class="variacao-checkbox w-4 h-4 text-primary rounded focus:ring-primary">
                <span class="text-sm font-medium flex-grow">üå± Vegano</span>
              </label>
              <div class="preco-input-container">
                <input 
                  type="number" 
                  data-preco-variacao="vegano"
                  step="0.01" 
                  min="0"
                  placeholder="Pre√ßo (R$)"
                  class="w-full border rounded-md py-2 px-3 text-sm dark:bg-gray-700 dark:border-gray-600"
                />
              </div>
            </div>

            <!-- Vegetariano -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-3">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="variacao" value="vegetariano" class="variacao-checkbox w-4 h-4 text-primary rounded focus:ring-primary">
                <span class="text-sm font-medium flex-grow">ü•ó Vegetariano</span>
              </label>
              <div class="preco-input-container">
                <input 
                  type="number" 
                  data-preco-variacao="vegetariano"
                  step="0.01" 
                  min="0"
                  placeholder="Pre√ßo (R$)"
                  class="w-full border rounded-md py-2 px-3 text-sm dark:bg-gray-700 dark:border-gray-600"
                />
              </div>
            </div>
          </div>
          
          <!-- Pre√ßo (apenas para bebidas) -->
          <div id="preco-bebida-container">
            <label class="block text-sm font-medium" for="dish-price">Pre√ßo (R$)</label>
            <input 
              id="dish-price" 
              type="number" 
              step="0.01" 
              min="0"
              placeholder="0.00"
              class="mt-1 block w-full border rounded-md py-2 px-3 dark:bg-gray-700 dark:border-gray-600 focus:ring-2 focus:ring-primary focus:border-transparent"
            />
          </div>
          
          <!-- URL da Imagem -->
          <div>
            <label class="block text-sm font-medium" for="dish-image-url">URL da Imagem (opcional)</label>
            <input 
              id="dish-image-url" 
              type="url" 
              placeholder="https://exemplo.com/imagem.jpg" 
              class="mt-1 block w-full border rounded-md py-2 px-3 dark:bg-gray-700 dark:border-gray-600 focus:ring-2 focus:ring-primary focus:border-transparent"
            />
            <p class="text-xs text-subtext-light dark:text-subtext-dark mt-1">
              Cole o link de uma imagem hospedada online
            </p>
          </div>
          
          <!-- Bot√£o Submit -->
          <button 
            type="submit" 
            id="submit-btn"
            class="w-full bg-primary text-white font-bold py-2 px-4 rounded-lg hover:bg-orange-600 transition-colors"
          >
            Adicionar Item
          </button>
        </form>
      </div>
    </div>

    <!-- Lista de Itens Ativos -->
    <div>
      <h2 class="text-xl font-semibold mb-4">Itens Cadastrados</h2>
      <div class="space-y-4" id="lista-pratos">
        <div class="text-center py-8">
          <p class="text-subtext-light dark:text-subtext-dark">Carregando itens...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ PROTE√á√ÉO DE ADMIN + Script Principal -->
  <script type="module">
    if (!window.auth) {
      await new Promise(resolve => setTimeout(resolve, 100));
    }
    
    if (!auth.estaLogado()) {
      alert('‚ö†Ô∏è Acesso negado! Voc√™ precisa estar logado.');
      window.location.href = 'login.html';
      throw new Error('N√£o autorizado');
    }
    
    if (!auth.isAdmin()) {
      alert('‚ö†Ô∏è Acesso negado! Apenas administradores podem acessar esta p√°gina.');
      window.location.href = 'index.html';
      throw new Error('N√£o autorizado');
    }
    
    const usuarioAdmin = auth.getUsuarioLogado();
    console.log('‚úÖ Admin autenticado:', usuarioAdmin.nome);
    
    document.getElementById('admin-info').textContent = 
      `Bem-vindo, ${usuarioAdmin.nome} (Admin)`;
    
    document.getElementById('logoutBtn').addEventListener('click', () => {
      if (confirm('Deseja sair do painel de administra√ß√£o?')) {
        auth.fazerLogout();
      }
    });
    
    // ========================================
    // ‚úÖ NOVO: CONTROLA VISIBILIDADE BASEADO NO TIPO
    // ========================================
    const tipoSelect = document.getElementById('item-tipo');
    const variacoesContainer = document.getElementById('variacoes-container');
    const precoBebidaContainer = document.getElementById('preco-bebida-container');
    const dishPrice = document.getElementById('dish-price');
    
    function atualizarCamposPorTipo() {
      if (tipoSelect.value === 'bebida') {
        // Mostra pre√ßo √∫nico, esconde varia√ß√µes
        variacoesContainer.style.display = 'none';
        precoBebidaContainer.style.display = 'block';
        dishPrice.required = true;
        
        // Desmarca todas as varia√ß√µes
        document.querySelectorAll('input[name="variacao"]').forEach(cb => {
          cb.checked = false;
        });
        // Limpa pre√ßos das varia√ß√µes
        document.querySelectorAll('[data-preco-variacao]').forEach(input => {
          input.value = '';
        });
      } else {
        // Mostra varia√ß√µes, esconde pre√ßo √∫nico
        variacoesContainer.style.display = 'block';
        precoBebidaContainer.style.display = 'none';
        dishPrice.required = false;
        dishPrice.value = '';
      }
    }
    
    tipoSelect.addEventListener('change', atualizarCamposPorTipo);
    atualizarCamposPorTipo(); // Inicializa corretamente
  </script>

  <!-- Script principal da tela admin -->
  <script type="module" src="./tela_adm.js"></script>
</body>
</html>